#+EXPORT_FILE_NAME: README.md
#+OPTIONS: toc:nil |:t ^:nil tags:nil

#+NAME: name
#+BEGIN_SRC text :exports none :noweb yes
loadstar_sensors_interface
#+END_SRC

#+NAME: version
#+BEGIN_SRC text :exports none :noweb yes
0.3.0
#+END_SRC

#+NAME: repository-name
#+BEGIN_SRC text :exports none :noweb yes
loadstar_sensors_interface_python
#+END_SRC

#+NAME: guix-name
#+BEGIN_SRC text :exports none :noweb yes
python-loadstar-sensors-interface
#+END_SRC

#+NAME: description
#+BEGIN_SRC text :exports none :noweb yes
Python interface to Loadstar Sensors USB devices.
#+END_SRC

#+NAME: license
#+BEGIN_SRC text :exports none :noweb yes
BSD 3-Clause License
#+END_SRC

#+NAME: url
#+BEGIN_SRC text :exports none :noweb yes
https://github.com/janelia-pypi/<<repository-name>>
#+END_SRC

#+NAME: author
#+BEGIN_SRC text :exports none :noweb yes
Peter Polidoro
#+END_SRC

#+NAME: email
#+BEGIN_SRC text :exports none :noweb yes
peter@polidoro.io
#+END_SRC

#+NAME: copyright
#+BEGIN_SRC text :exports none :noweb yes
2022 Howard Hughes Medical Institute
#+END_SRC

#+NAME: dependencies
#+BEGIN_SRC text :exports none :noweb yes
serial_interface
#+END_SRC

#+NAME: reference
#+BEGIN_SRC text :exports none :noweb yes
https://www.loadstarsensors.com/
#+END_SRC

#+BEGIN_EXAMPLE
<!-- README.md is generated automatically from .single-source-of-truth.org
File edits may be overwritten! -->
#+END_EXAMPLE

* About

#+BEGIN_SRC markdown :noweb yes
- Name: <<name>>
- Version: <<version>>
- Description: <<description>>
- License: <<license>>
- URL: <<url>>
- Author: <<author>>
- Email: <<email>>
- Copyright: <<copyright>>
- Reference: <<reference>>
- Dependencies:
  - <<dependencies>>
#+END_SRC

* Example Usage

#+BEGIN_SRC python
from loadstar_sensors_interface import LoadstarSensorsInterface
dev = LoadstarSensorsInterface() # Try to automatically detect port
dev = LoadstarSensorsInterface(port='/dev/ttyUSB0') # Linux specific port
dev = LoadstarSensorsInterface(port='/dev/tty.usbmodem262471') # Mac OS X specific port
dev = LoadstarSensorsInterface(port='COM3') # Windows specific port

dev.tare()
sensor_value = dev.get_sensor_value()

model = dev.get_model()
id = dev.get_id()
units = dev.get_units()
load_capactiy = dev.get_load_capacity()
gain = dev.get_gain()
dev.set_averaging_window(100) # 1-1024 samples
dev.set_averaging_threshold(10) # 1-100 percent


#+END_SRC

* Installation

[[https://github.com/janelia-pypi/python_setup]]

** Linux

*** udev rules

#+BEGIN_SRC sh :noweb yes
sudo cp 77-loadstar-sensors.rules /etc/udev/rules.d/
#+END_SRC

*** pip

#+BEGIN_SRC sh :noweb yes
python3 -m venv ~/venvs/<<name>>
source ~/venvs/<<name>>/bin/activate
pip install <<name>>
#+END_SRC

*** guix

Setup guix-janelia channel:

https://github.com/guix-janelia/guix-janelia

#+BEGIN_SRC sh :noweb yes
guix install <<guix-name>>
#+END_SRC

** Windows

*** drivers

Download and install Windows driver:

[[https://www.loadstarsensors.com/drivers-for-usb-load-cells-and-load-cell-interfaces.html][Loadstar Sensors Windows Driver]]

*** pip

#+BEGIN_SRC sh :noweb yes
python3 -m venv C:\venvs\<<name>>
C:\venvs\<<name>>\Scripts\activate
pip install <<name>>
#+END_SRC

* Test

#+BEGIN_SRC sh :noweb yes
guix shell picocom
picocom -b 9600 -f n -y n -d 8 -p 1 -c /dev/ttyUSB0
?
#+END_SRC

* Development :noexport:

** Guix

#+BEGIN_SRC sh :noweb yes
git clone <<url>>
cd <<repository_name>>
make shell
make edits
make all
exit
#+END_SRC

* Tangled Files                                                    :noexport:

#+BEGIN_SRC text :tangle MANIFEST.in :exports none :noweb yes
# MANIFEST.in is generated automatically from .single-source-of-truth.org
# File edits may be overwritten!
include 77-loadstar-sensors.rules
include README.md
include LICENSE
#+END_SRC

#+BEGIN_SRC text :tangle 77-loadstar-sensors.rules :exports none :noweb yes
# 77-loadstar-sensors.rules is generated automatically from .single-source-of-truth.org
# File edits may be overwritten!
# UDEV Rules for <<reference>> devices.
#
# The latest version of this file may be found at:
#   <<url>>
#
# This file must be placed at:
#
# /etc/udev/rules.d/77-loadstar-sensors.rules
#
# To install, type this command in a terminal:
#   sudo cp 77-loadstar-sensors.rules /etc/udev/rules.d/
#
# After this file is installed, physically unplug and reconnect device.
#
# Original FT232/FT245 VID:PID
ATTRS{idVendor}=="0403", ATTRS{idProduct}=="6001", MODE="0666", ENV{ID_MM_DEVICE_IGNORE}="1", ENV{ID_MM_PORT_IGNORE}="1"
#+END_SRC

#+BEGIN_SRC text :tangle pyproject.toml :exports none :noweb yes
# pyproject.toml is generated automatically from .single-source-of-truth.org
# File edits may be overwritten!
[build-system]
requires = [
    "setuptools>=42",
    "wheel"
]
#+END_SRC

#+BEGIN_SRC text :tangle setup.cfg :exports none :noweb yes
# setup.cfg is generated automatically from .single-source-of-truth.org
# File edits may be overwritten!
[metadata]
name = <<name>>
version = <<version>>
author = <<author>>
author_email = <<email>>
url = <<url>>
description = <<description>>
long_description = file: README.md
long_description_content_type = text/markdown
license = <<license>>
classifiers =
    Programming Language :: Python :: 3

[options]
packages = find:
install_requires =
    <<dependencies>>

[options.packages.find]
exclude =
    examples*
    tools*
    docs*
    <<name>>.tests*

[bdist_wheel]
# This flag says that the code is written to work on both Python 2 and Python
# 3. If at all possible, it is good practice to do this. If you cannot, you
# will need to generate wheels for each Python version that you support.
universal=1
#+END_SRC

#+BEGIN_SRC python :tangle setup.py :exports none :noweb yes
# setup.py is generated automatically from .single-source-of-truth.org
# File edits may be overwritten!
from setuptools import setup


if __name__ == '__main__':
    setup()
#+END_SRC

#+BEGIN_SRC python :tangle loadstar_sensors_interface/__about__.py :exports none :noweb yes
# __about__.py is generated automatically from .single-source-of-truth.org
# File edits may be overwritten!
__version__ = '<<version>>'
__description__ = '<<description>>'
__license__ = '<<license>>'
__url__ = '<<url>>'
__author__ = '<<author>>'
__email__ = '<<email>>'
__copyright__ = '<<copyright>>'
#+END_SRC

#+BEGIN_SRC python :tangle loadstar_sensors_interface/__init__.py :exports none :noweb yes
'''
<<description>>
'''

# __init__.py is generated automatically from .single-source-of-truth.org
# File edits may be overwritten!
from loadstar_sensors_interface.__about__ import (
    __author__,
    __copyright__,
    __email__,
    __license__,
    __description__,
    __url__,
    __version__,
)

from .loadstar_sensors_interface import LoadstarSensorsInterface
#+END_SRC
